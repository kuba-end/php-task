{% extends 'base.html.twig' %}

{% block body %}
    <div style="display:flex; gap:30px; margin-top:30px;">

        {# --------------------- FILTER SIDEBAR --------------------- #}
        <aside style="width:250px; padding:20px; border:1px solid #ddd; border-radius:8px;">
            <h3>Filters</h3>

            <form method="get">
                <label>Name</label>
                <input type="text" name="filter[name]" value="{{ app.request.get('filter')['name'] ?? '' }}" class="form-control">

                <label>Surname</label>
                <input type="text" name="filter[surname]" value="{{ app.request.get('filter')['surname'] ?? '' }}" class="form-control">

                <label>Department</label>
                <input type="text" name="filter[department]" value="{{ app.request.get('filter')['department'] ?? '' }}" class="form-control">

                <button style="margin-top:10px;" class="btn btn-primary">Apply</button>
            </form>

            <form method="get" style="margin-top:10px;">
                <button class="btn btn-secondary">Clear Filters</button>
            </form>
        </aside>


        {# --------------------- TABLE --------------------- #}
        <div style="flex:1;">
            <h2>Payroll Report</h2>

            <table class="table table-striped table-bordered">
                <thead>
                <tr>
                    {% set sortable = {
                        'name': 'Name',
                        'surname': 'Surname',
                        'department': 'Department',
                        'remunerationBase': 'Base',
                        'additionAmount': 'Addition',
                        'bonusType': 'Bonus Type',
                        'finalRemuneration': 'Final'
                    } %}

                    {% for field, label in sortable %}
                        <th>
                            {{ label }}

                            {# Build sorting URLs #}
                            {% set current = app.request.get('sort') %}
                            {% set ascUrl = path(app.request.attributes.get('_route'), app.request.query.all | merge({'sort': field})) %}
                            {% set descUrl = path(app.request.attributes.get('_route'), app.request.query.all | merge({'sort': '-' ~ field})) %}

                            <a href="{{ ascUrl }}" style="text-decoration:none;">▲</a>
                            <a href="{{ descUrl }}" style="text-decoration:none;">▼</a>

                            {# Highlight active sort #}
                            {% if current == field %}
                                <span style="color:green;">(asc)</span>
                            {% elseif current == '-' ~ field %}
                                <span style="color:green;">(desc)</span>
                            {% endif %}
                        </th>
                    {% endfor %}
                </tr>
                </thead>

                <tbody>
                {% for item in payroll %}
                    {% set attr = item.data.attributes %}
                    <tr>
                        <td>{{ attr.name }}</td>
                        <td>{{ attr.surname }}</td>
                        <td>{{ attr.department }}</td>
                        <td>{{ attr.remunerationBase }}</td>
                        <td>{{ attr.additionAmount }}</td>
                        <td>{{ attr.bonusType }}</td>
                        <td>{{ attr.finalRemuneration }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
{% endblock %}
